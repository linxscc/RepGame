-- =============================================
-- 羁绊配置数据库创建脚本
-- 基于 BondConfig.json 生成
-- =============================================

-- 创建羁绊主表
CREATE TABLE IF NOT EXISTS bonds (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '羁绊ID',
    name VARCHAR(50) NOT NULL COMMENT '羁绊名称',
    level INT NOT NULL COMMENT '羁绊等级',
    damage DECIMAL(5,1) NOT NULL COMMENT '羁绊伤害',
    skill VARCHAR(100) DEFAULT '' COMMENT '羁绊技能',
    description VARCHAR(200) NOT NULL COMMENT '羁绊描述',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_level (level),
    INDEX idx_name (name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='羁绊配置表';

-- 创建羁绊卡牌关联表
CREATE TABLE IF NOT EXISTS bond_cards (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '关联ID',
    bond_id INT NOT NULL COMMENT '羁绊ID',
    card_name VARCHAR(50) NOT NULL COMMENT '卡牌名称',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (bond_id) REFERENCES bonds(id) ON DELETE CASCADE,
    INDEX idx_bond_id (bond_id),
    INDEX idx_card_name (card_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='羁绊卡牌关联表';

-- 创建视图：包含卡牌信息的羁绊视图
CREATE OR REPLACE VIEW bond_details AS
SELECT 
    b.id,
    b.name,
    b.level,
    b.damage,
    b.skill,
    b.description,
    GROUP_CONCAT(bc.card_name ORDER BY bc.card_name SEPARATOR ',') AS cards
FROM bonds b
LEFT JOIN bond_cards bc ON b.id = bc.bond_id
GROUP BY b.id, b.name, b.level, b.damage, b.skill, b.description
ORDER BY b.level, b.damage;

-- 清空现有数据
DELETE FROM bond_cards;
DELETE FROM bonds;

-- 重置自增ID
ALTER TABLE bonds AUTO_INCREMENT = 1;
ALTER TABLE bond_cards AUTO_INCREMENT = 1;

-- 插入羁绊数据
-- Level 1 羁绊 (36个)
INSERT INTO bonds (name, level, damage, skill, description) VALUES
('修行之道', 1, 4.0, '', '不同信仰的修行者'),
('艺术启蒙', 1, 4.0, '', '艺术领域的学徒'),
('工匠初心', 1, 4.0, '', '工艺学徒的初始羁绊'),
('劳动力量', 1, 4.0, '', '劳动与军事的基础'),
('求学路', 1, 4.0, '', '求知的年轻人'),
('服务民众', 1, 4.0, '', '为民服务的基层'),
('医护之道', 1, 4.0, '', '关注生命的医者'),
('军政基础', 1, 4.0, '', '军事与政治的基础'),
('文武之道', 1, 4.0, '', '文武并重'),
('创意火花', 1, 4.0, '', '设计与学习的结合'),
('手工艺术', 1, 4.0, '', '手工与艺术的结合'),
('实用技能', 1, 4.0, '', '实用性技能'),
('传统工艺', 1, 4.0, '', '传统工艺的传承'),
('商业萌芽', 1, 4.0, '', '商业与设计的结合'),
('服务意识', 1, 4.0, '', '为民服务的意识'),
('武道初心', 1, 4.0, '', '武道与修行的初心'),
('民间智慧', 1, 4.0, '', '民间与学院智慧'),
('信仰启蒙', 1, 6.0, '', '求知与信仰的结合'),
('市井生活', 1, 6.0, '', '市场上的手艺人'),
('创作基础', 1, 6.0, '', '创作与学习'),
('底层反抗', 1, 6.0, '', '底层民众的团结'),
('技艺传承', 1, 6.0, '', '传统技艺的传承'),
('民生基础', 1, 6.0, '', '民生相关职业'),
('社会基层', 1, 6.0, '', '社会基层的联合'),
('精神追求', 1, 6.0, '', '精神层面的追求'),
('创造基因', 1, 6.0, '', '创造性职业的联合'),
('基础建设', 1, 6.0, '', '社会基础建设'),
('青年力量', 1, 8.0, '', '年轻一代的力量'),
('学徒联盟', 1, 8.0, '', '工艺学徒的大联盟'),
('全民启蒙', 1, 8.0, '', '全民教育与启蒙'),
('文化基础', 1, 10.0, '', '文化与精神的基础'),
('社会支柱', 1, 10.0, '', '构成社会的五大支柱'),
('工艺大师', 1, 12.0, '', '各种工艺的大师级组合'),
('基层英雄', 1, 33.0, '', '社会基层的英雄联盟'),
('天下学子', 1, 33.0, '', '各行各业的学子联盟'),
('民族脊梁', 1, 33.0, '', '支撑民族的脊梁力量');

-- Level 2 羁绊 (11个)
INSERT INTO bonds (name, level, damage, skill, description) VALUES
('工匠精神', 2, 15.0, '', '熟练工匠的精神'),
('民生保障', 2, 14.0, '', '民生相关的保障'),
('艺术传承', 2, 16.0, '', '艺术领域的传承'),
('治理之道', 2, 18.0, '', '治国理政的智慧'),
('信仰力量', 2, 17.0, '', '宗教信仰的力量'),
('商业网络', 2, 13.0, '', '商业与政治的结合'),
('知识传播', 2, 16.0, '', '知识的传播与发展'),
('军政联合', 2, 20.0, '', '军事与政治的联合'),
('技艺融合', 2, 15.0, '', '不同技艺的融合'),
('社会精英', 2, 22.0, '', '社会各界精英'),
('五行合一', 2, 33.0, '', '五大Level 2职业的完美结合');

-- Level 3 羁绊 (8个)
INSERT INTO bonds (name, level, damage, skill, description) VALUES
('百工之巅', 3, 30.0, '', '工艺技术的最高境界'),
('艺术至尊', 3, 32.0, '', '艺术与智慧的完美结合'),
('权力中枢', 3, 35.0, '', '国家权力的核心'),
('精神领袖', 3, 28.0, '', '精神与智慧的领导者'),
('商业帝国', 3, 26.0, '', '商业与政治的完美结合'),
('文武双全', 3, 33.0, '', '文武兼备的治世之才'),
('创新联盟', 3, 29.0, '', '创新技术的联盟'),
('治世联盟', 3, 40.0, '', '治理天下的完美组合');

-- Level 4 羁绊 (5个)
INSERT INTO bonds (name, level, damage, skill, description) VALUES
('天人合一', 4, 75.0, '', '智慧与信仰的完美统一'),
('权势巅峰', 4, 80.0, '', '政治与军事的完美融合'),
('文明之光', 4, 85.0, '', '文明发展的最高体现'),
('至尊联盟', 4, 90.0, '', '政治与学术的至高联盟'),
('完美世界', 4, 100.0, '', '理想世界的完美体现');

-- 插入羁绊卡牌关联数据
-- Level 1 羁绊的卡牌关联
INSERT INTO bond_cards (bond_id, card_name) VALUES
-- 修行之道
(1, '道童'), (1, '沙弥'),
-- 艺术启蒙
(2, '艺术学徒'), (2, '设计学徒'),
-- 工匠初心
(3, '木匠学徒'), (3, '铁匠学徒'),
-- 劳动力量
(4, '农民学徒'), (4, '兵卒'),
-- 求学路
(5, '学生'), (5, '医学生'),
-- 服务民众
(6, '吏员'), (6, '小贩'),
-- 医护之道
(7, '医学生'), (7, '道童'),
-- 军政基础
(8, '兵卒'), (8, '吏员'),
-- 文武之道
(9, '学生'), (9, '兵卒'),
-- 创意火花
(10, '设计学徒'), (10, '学生'),
-- 手工艺术
(11, '木匠学徒'), (11, '艺术学徒'),
-- 实用技能
(12, '铁匠学徒'), (12, '医学生'),
-- 传统工艺
(13, '木匠学徒'), (13, '农民学徒'),
-- 商业萌芽
(14, '小贩'), (14, '设计学徒'),
-- 服务意识
(15, '医学生'), (15, '吏员'),
-- 武道初心
(16, '兵卒'), (16, '道童'),
-- 民间智慧
(17, '农民学徒'), (17, '学生'),
-- 信仰启蒙
(18, '道童'), (18, '沙弥'), (18, '学生'),
-- 市井生活
(19, '小贩'), (19, '木匠学徒'), (19, '铁匠学徒'),
-- 创作基础
(20, '艺术学徒'), (20, '学生'), (20, '设计学徒'),
-- 底层反抗
(21, '农民学徒'), (21, '吏员'), (21, '兵卒'),
-- 技艺传承
(22, '木匠学徒'), (22, '铁匠学徒'), (22, '医学生'),
-- 民生基础
(23, '农民学徒'), (23, '医学生'), (23, '小贩'),
-- 社会基层
(24, '小贩'), (24, '农民学徒'), (24, '吏员'),
-- 精神追求
(25, '道童'), (25, '学生'), (25, '艺术学徒'),
-- 创造基因
(26, '艺术学徒'), (26, '铁匠学徒'), (26, '设计学徒'),
-- 基础建设
(27, '木匠学徒'), (27, '铁匠学徒'), (27, '农民学徒'),
-- 青年力量
(28, '学生'), (28, '艺术学徒'), (28, '设计学徒'), (28, '医学生'),
-- 学徒联盟
(29, '木匠学徒'), (29, '铁匠学徒'), (29, '农民学徒'), (29, '艺术学徒'),
-- 全民启蒙
(30, '学生'), (30, '道童'), (30, '沙弥'), (30, '医学生'),
-- 文化基础
(31, '学生'), (31, '艺术学徒'), (31, '设计学徒'), (31, '道童'), (31, '沙弥'),
-- 社会支柱
(32, '农民学徒'), (32, '医学生'), (32, '兵卒'), (32, '吏员'), (32, '小贩'),
-- 工艺大师
(33, '木匠学徒'), (33, '铁匠学徒'), (33, '农民学徒'), (33, '艺术学徒'), (33, '设计学徒'), (33, '医学生'),
-- 基层英雄
(34, '木匠学徒'), (34, '铁匠学徒'), (34, '农民学徒'), (34, '医学生'), (34, '兵卒'), (34, '学生'), (34, '道童'),
-- 天下学子
(35, '学生'), (35, '医学生'), (35, '艺术学徒'), (35, '设计学徒'), (35, '道童'), (35, '沙弥'), (35, '吏员'),
-- 民族脊梁
(36, '农民学徒'), (36, '木匠学徒'), (36, '铁匠学徒'), (36, '兵卒'), (36, '医学生'), (36, '吏员'), (36, '小贩');

-- Level 2 羁绊的卡牌关联
INSERT INTO bond_cards (bond_id, card_name) VALUES
-- 工匠精神
(37, '木匠'), (37, '铁匠'), (37, '百工专家'),
-- 民生保障
(38, '农民'), (38, '医师'), (38, '游商'),
-- 艺术传承
(39, '梦想家'), (39, '设计师'), (39, '艺术家'),
-- 治理之道
(40, '官员'), (40, '老兵'), (40, '学者'),
-- 信仰力量
(41, '道士'), (41, '和尚'), (41, '住持'),
-- 商业网络
(42, '游商'), (42, '商人'), (42, '官员'),
-- 知识传播
(43, '学者'), (43, '教授'), (43, '道士'),
-- 军政联合
(44, '老兵'), (44, '统领'), (44, '官员'),
-- 技艺融合
(45, '木匠'), (45, '铁匠'), (45, '医师'), (45, '设计师'),
-- 社会精英
(46, '学者'), (46, '官员'), (46, '梦想家'), (46, '医师'),
-- 五行合一
(47, '木匠'), (47, '铁匠'), (47, '农民'), (47, '医师'), (47, '道士');

-- Level 3 羁绊的卡牌关联
INSERT INTO bond_cards (bond_id, card_name) VALUES
-- 百工之巅
(48, '百工专家'), (48, '木匠'), (48, '铁匠'), (48, '医师'), (48, '农民'),
-- 艺术至尊
(49, '艺术家'), (49, '梦想家'), (49, '设计师'), (49, '教授'),
-- 权力中枢
(50, '相国'), (50, '统领'), (50, '官员'), (50, '老兵'),
-- 精神领袖
(51, '住持'), (51, '教授'), (51, '道士'), (51, '和尚'),
-- 商业帝国
(52, '商人'), (52, '游商'), (52, '相国'), (52, '百工专家'),
-- 文武双全
(53, '教授'), (53, '统领'), (53, '学者'), (53, '老兵'),
-- 创新联盟
(54, '艺术家'), (54, '百工专家'), (54, '教授'), (54, '设计师'),
-- 治世联盟
(55, '相国'), (55, '教授'), (55, '住持'), (55, '统领'), (55, '商人');

-- Level 4 羁绊的卡牌关联
INSERT INTO bond_cards (bond_id, card_name) VALUES
-- 天人合一
(56, '教授'), (56, '住持'),
-- 权势巅峰
(57, '相国'), (57, '统领'),
-- 文明之光
(58, '教授'),
-- 至尊联盟
(59, '相国'), (59, '教授'),
-- 完美世界
(60, '相国');

-- 创建查询统计信息的视图
CREATE OR REPLACE VIEW bond_statistics AS
SELECT 
    level,
    COUNT(*) as bond_count,
    MIN(damage) as min_damage,
    MAX(damage) as max_damage,
    AVG(damage) as avg_damage
FROM bonds 
GROUP BY level
ORDER BY level;

-- 查询验证数据
SELECT 'Bond Statistics:' as info;
SELECT * FROM bond_statistics;

SELECT 'Total Bonds by Level:' as info;
SELECT level, COUNT(*) as count FROM bonds GROUP BY level ORDER BY level;

SELECT 'Sample Bond Details:' as info;
SELECT * FROM bond_details LIMIT 10;
